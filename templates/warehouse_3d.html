<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Warehouse 3D Visualization</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      background: #0a0a0a;
      color: #fff;
    }

    #container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }

    #three-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .ui-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .header {
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      padding: 20px 30px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .title {
      font-size: 1.8em;
      font-weight: 300;
      letter-spacing: 2px;
    }

    .status-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 20px;
      background: rgba(46, 204, 113, 0.2);
      border: 1px solid #2ecc71;
      border-radius: 20px;
      font-size: 0.9em;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: #2ecc71;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }

    .stats-panel {
      position: absolute;
      top: 110px;
      left: 20px;
      width: 320px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      pointer-events: auto;
    }

    .stats-panel h3 {
      font-size: 1em;
      font-weight: 400;
      opacity: 0.7;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-row:last-child {
      border-bottom: none;
    }

    .stat-label {
      opacity: 0.8;
      font-size: 0.95em;
    }

    .stat-value {
      font-weight: 600;
      font-size: 1.1em;
    }

    .robot-panel {
      position: absolute;
      top: 110px;
      right: 20px;
      width: 320px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      pointer-events: auto;
    }

    .robot-status {
      margin-bottom: 15px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border-left: 3px solid;
    }

    .robot-status.supply {
      border-left-color: #e74c3c;
    }

    .robot-status.delivery {
      border-left-color: #9b59b6;
    }

    .robot-name {
      font-weight: 600;
      font-size: 1.1em;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .robot-detail {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      margin-top: 8px;
      opacity: 0.9;
    }

    .controls-hint {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      padding: 15px 30px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9em;
      opacity: 0.7;
    }

    .queue-panel {
      position: absolute;
      bottom: 80px;
      left: 20px;
      width: 320px;
      max-height: 300px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      overflow-y: auto;
      pointer-events: auto;
    }

    .queue-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .queue-item {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      font-size: 0.85em;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    .legend {
      position: absolute;
      bottom: 80px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px;
      pointer-events: auto;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 10px 0;
      font-size: 0.9em;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }

    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0a0a;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 20px;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loader {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .shelf-info {
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 0.85em;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .shelf-info.visible {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="loading" class="loading-screen">
    <div class="loader"></div>
    <div>Loading 3D Environment...</div>
  </div>

  <div id="container">
    <canvas id="three-canvas"></canvas>

    <div class="ui-overlay">
      <div class="header">
        <div class="title">WAREHOUSE 3D VISUALIZATION</div>
        <div class="status-badge">
          <div class="status-dot"></div>
          <span>LIVE</span>
        </div>
      </div>

      <div class="stats-panel">
        <h3>Inventory Overview</h3>
        <div class="stat-row">
          <span class="stat-label">Total Items</span>
          <span class="stat-value" id="totalItems">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Item A</span>
          <span class="stat-value" id="itemA">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Item B</span>
          <span class="stat-value" id="itemB">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Item C</span>
          <span class="stat-value" id="itemC">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Delivered</span>
          <span class="stat-value" id="deliveredCount">0</span>
        </div>
      </div>

      <div class="robot-panel">
        <h3>Robot Status</h3>
        <div class="robot-status supply">
          <div class="robot-name">
            <span>‚ö°</span>
            Supply Robot
          </div>
          <div class="robot-detail">
            <span>Position:</span>
            <span id="supplyPos">-</span>
          </div>
          <div class="robot-detail">
            <span>Carrying:</span>
            <span id="supplyCarrying">None</span>
          </div>
        </div>
        <div class="robot-status delivery">
          <div class="robot-name">
            <span>üöö</span>
            Delivery Robot
          </div>
          <div class="robot-detail">
            <span>Position:</span>
            <span id="deliveryPos">-</span>
          </div>
          <div class="robot-detail">
            <span>Carrying:</span>
            <span id="deliveryCarrying">None</span>
          </div>
        </div>
      </div>

      <div class="queue-panel">
        <h3>Incoming Supply Queue</h3>
        <div class="queue-items" id="incomingQueue"></div>
      </div>

      <div class="legend">
        <h3>Legend</h3>
        <div class="legend-item">
          <div class="legend-color" style="background: #27ae60;"></div>
          <span>Supply Station</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #2980b9;"></div>
          <span>Delivery Station</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #e74c3c;"></div>
          <span>Supply Robot</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #9b59b6;"></div>
          <span>Delivery Robot</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #888888;"></div>
          <span>Storage Shelves</span>
        </div>
      </div>

      <div class="controls-hint">
        üñ±Ô∏è Left Click + Drag: Rotate | Right Click + Drag: Pan | Scroll: Zoom
      </div>
    </div>
  </div>

  <div class="shelf-info" id="shelfInfo"></div>

  <script>
    const socket = io();
    let scene, camera, renderer, controls;
    let supplyRobot3D, deliveryRobot3D;
    let shelfGroups = [];
    let itemMeshes = [];
    const LERP_FACTOR = 0.1;

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x1a1a1a);
      scene.fog = new THREE.Fog(0x1a1a1a, 20, 50);

      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(8, 12, 15);

      renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById('three-canvas'),
        antialias: true,
        alpha: false
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.2;

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.minDistance = 5;
      controls.maxDistance = 30;
      controls.maxPolarAngle = Math.PI / 2.2;
      controls.target.set(5, 0, 5);

      createLighting();
      createEnvironment();
      createStations();
      createShelves();
      createRobots();

      window.addEventListener('resize', onWindowResize);

      setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
      }, 1000);

      animate();
    }

    function createLighting() {
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambientLight);

      const mainLight = new THREE.DirectionalLight(0xffffff, 1.2);
      mainLight.position.set(10, 15, 10);
      mainLight.castShadow = true;
      mainLight.shadow.camera.left = -15;
      mainLight.shadow.camera.right = 15;
      mainLight.shadow.camera.top = 15;
      mainLight.shadow.camera.bottom = -15;
      mainLight.shadow.mapSize.width = 2048;
      mainLight.shadow.mapSize.height = 2048;
      mainLight.shadow.bias = -0.0001;
      scene.add(mainLight);

      const fillLight = new THREE.DirectionalLight(0x4a90e2, 0.3);
      fillLight.position.set(-10, 5, -10);
      scene.add(fillLight);

      const rimLight = new THREE.DirectionalLight(0xff9a56, 0.2);
      rimLight.position.set(0, 5, -10);
      scene.add(rimLight);

      const hemiLight = new THREE.HemisphereLight(0x4a90e2, 0x2c3e50, 0.4);
      scene.add(hemiLight);
    }

    function createEnvironment() {
      const floorGeometry = new THREE.PlaneGeometry(50, 50);
      const floorMaterial = new THREE.MeshStandardMaterial({
        color: 0x2c3e50,
        roughness: 0.8,
        metalness: 0.2
      });
      const floor = new THREE.Mesh(floorGeometry, floorMaterial);
      floor.rotation.x = -Math.PI / 2;
      floor.position.y = -0.01;
      floor.receiveShadow = true;
      scene.add(floor);

      const gridHelper = new THREE.GridHelper(50, 50, 0x445566, 0x2a3544);
      gridHelper.position.y = 0;
      scene.add(gridHelper);

      const warehouseFloor = new THREE.Mesh(
        new THREE.PlaneGeometry(10, 10),
        new THREE.MeshStandardMaterial({
          color: 0x34495e,
          roughness: 0.7,
          metalness: 0.3
        })
      );
      warehouseFloor.rotation.x = -Math.PI / 2;
      warehouseFloor.position.y = 0;
      warehouseFloor.receiveShadow = true;
      scene.add(warehouseFloor);

      for (let i = 0; i <= 10; i++) {
        const lineMat = new THREE.LineBasicMaterial({ color: 0x4a5568, opacity: 0.5, transparent: true });
        const points = [];
        points.push(new THREE.Vector3(i, 0.01, 0));
        points.push(new THREE.Vector3(i, 0.01, 10));
        const geometry = new THREE.BufferGeometry().setFromPoints(points);
        const line = new THREE.Line(geometry, lineMat);
        scene.add(line);

        const points2 = [];
        points2.push(new THREE.Vector3(0, 0.01, i));
        points2.push(new THREE.Vector3(10, 0.01, i));
        const geometry2 = new THREE.BufferGeometry().setFromPoints(points2);
        const line2 = new THREE.Line(geometry2, lineMat);
        scene.add(line2);
      }
    }

    function createStations() {
      const supplyStation = createStation(0x27ae60, 5, 0);
      const deliveryStation = createStation(0x2980b9, 5, 9);

      const supplyLabel = createLabel('SUPPLY', 0x27ae60);
      supplyLabel.position.set(5, 1.2, 0);
      scene.add(supplyLabel);

      const deliveryLabel = createLabel('DELIVERY', 0x2980b9);
      deliveryLabel.position.set(5, 1.2, 9);
      scene.add(deliveryLabel);
    }

    function createStation(color, x, z) {
      const group = new THREE.Group();

      const base = new THREE.Mesh(
        new THREE.BoxGeometry(0.9, 0.1, 0.9),
        new THREE.MeshStandardMaterial({
          color: color,
          roughness: 0.4,
          metalness: 0.6,
          emissive: color,
          emissiveIntensity: 0.3
        })
      );
      base.position.y = 0.05;
      base.castShadow = true;
      base.receiveShadow = true;
      group.add(base);

      const platform = new THREE.Mesh(
        new THREE.CylinderGeometry(0.4, 0.45, 0.3, 8),
        new THREE.MeshStandardMaterial({
          color: color,
          roughness: 0.3,
          metalness: 0.7,
          emissive: color,
          emissiveIntensity: 0.2
        })
      );
      platform.position.y = 0.25;
      platform.castShadow = true;
      group.add(platform);

      const light = new THREE.PointLight(color, 0.5, 3);
      light.position.y = 0.5;
      group.add(light);

      group.position.set(x, 0, z);
      scene.add(group);
      return group;
    }

    function createLabel(text, color) {
      const canvas = document.createElement('canvas');
      canvas.width = 256;
      canvas.height = 64;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = `#${color.toString(16).padStart(6, '0')}`;
      ctx.fillRect(0, 0, 256, 64);
      ctx.fillStyle = 'white';
      ctx.font = 'bold 32px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, 128, 32);

      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.SpriteMaterial({ map: texture });
      const sprite = new THREE.Sprite(material);
      sprite.scale.set(1, 0.25, 1);
      return sprite;
    }

    function createShelves() {
      const positions = [[2, 2], [2, 7], [7, 2], [7, 7]];

      positions.forEach((pos, index) => {
        const shelfGroup = createShelf(pos[1], pos[0], index);
        shelfGroups.push(shelfGroup);
      });
    }

    function createShelf(x, z, index) {
      const group = new THREE.Group();
      const metalMat = new THREE.MeshStandardMaterial({
        color: 0x888888,
        roughness: 0.5,
        metalness: 0.8
      });

      const postGeo = new THREE.BoxGeometry(0.06, 2.4, 0.06);
      const corners = [[-0.42, -0.42], [0.42, -0.42], [-0.42, 0.42], [0.42, 0.42]];
      corners.forEach(pos => {
        const post = new THREE.Mesh(postGeo, metalMat);
        post.position.set(pos[0], 1.2, pos[1]);
        post.castShadow = true;
        post.receiveShadow = true;
        group.add(post);
      });

      const shelfGeo = new THREE.BoxGeometry(0.9, 0.04, 0.9);
      const shelfMat = new THREE.MeshStandardMaterial({
        color: 0x666666,
        roughness: 0.6,
        metalness: 0.7
      });

      [0.5, 1.0, 1.5, 2.0].forEach(y => {
        const shelf = new THREE.Mesh(shelfGeo, shelfMat);
        shelf.position.y = y;
        shelf.castShadow = true;
        shelf.receiveShadow = true;
        group.add(shelf);
      });

      const backPanel = new THREE.Mesh(
        new THREE.BoxGeometry(0.9, 2.4, 0.02),
        new THREE.MeshStandardMaterial({ color: 0x555555, roughness: 0.7, metalness: 0.6 })
      );
      backPanel.position.set(0, 1.2, -0.44);
      backPanel.castShadow = true;
      backPanel.receiveShadow = true;
      group.add(backPanel);

      group.position.set(x, 0, z);
      group.userData.shelfIndex = index;
      group.userData.itemMeshes = [];
      scene.add(group);

      return group;
    }

    function createRobots() {
      supplyRobot3D = createRobot(0xe74c3c, 'SR');
      supplyRobot3D.position.set(5, 0, 0);
      supplyRobot3D.userData.targetPos = { x: 5, z: 0 };

      deliveryRobot3D = createRobot(0x9b59b6, 'DR');
      deliveryRobot3D.position.set(5, 0, 9);
      deliveryRobot3D.userData.targetPos = { x: 5, z: 9 };
    }

    function createRobot(color, label) {
      const group = new THREE.Group();

      const bodyMat = new THREE.MeshStandardMaterial({
        color: color,
        roughness: 0.3,
        metalness: 0.7,
        emissive: color,
        emissiveIntensity: 0.2
      });

      const body = new THREE.Mesh(
        new THREE.BoxGeometry(0.5, 0.35, 0.7),
        bodyMat
      );
      body.position.y = 0.3;
      body.castShadow = true;
      body.receiveShadow = true;
      group.add(body);

      const head = new THREE.Mesh(
        new THREE.BoxGeometry(0.3, 0.25, 0.3),
        bodyMat
      );
      head.position.y = 0.6;
      head.castShadow = true;
      group.add(head);

      const wheelMat = new THREE.MeshStandardMaterial({
        color: 0x1a1a1a,
        roughness: 0.8,
        metalness: 0.9
      });

      const wheelGeo = new THREE.CylinderGeometry(0.1, 0.1, 0.08, 16);
      const wheelPositions = [
        [-0.22, 0.1, -0.3], [0.22, 0.1, -0.3],
        [-0.22, 0.1, 0.3], [0.22, 0.1, 0.3]
      ];

      wheelPositions.forEach(pos => {
        const wheel = new THREE.Mesh(wheelGeo, wheelMat);
        wheel.rotation.z = Math.PI / 2;
        wheel.position.set(pos[0], pos[1], pos[2]);
        wheel.castShadow = true;
        group.add(wheel);
        wheel.userData.isWheel = true;
      });

      const light = new THREE.PointLight(color, 0.8, 2);
      light.position.y = 0.5;
      group.add(light);

      scene.add(group);
      return group;
    }

    function updateRobotPosition(robot, targetX, targetZ) {
      robot.userData.targetPos.x = targetX;
      robot.userData.targetPos.z = targetZ;
    }

    function updateShelfItems(shelfIndex, items) {
      const shelfGroup = shelfGroups[shelfIndex];
      if (!shelfGroup) return;

      shelfGroup.userData.itemMeshes.forEach(mesh => {
        shelfGroup.remove(mesh);
      });
      shelfGroup.userData.itemMeshes = [];

      const itemColors = {
        'A': 0xff6b6b,
        'B': 0x4ecdc4,
        'C': 0xffe66d
      };

      let itemIndex = 0;
      items.forEach(item => {
        if (!item) return;

        const shelfLevel = Math.floor(itemIndex / 3);
        const posInShelf = itemIndex % 3;

        const itemGeo = new THREE.BoxGeometry(0.2, 0.15, 0.2);
        const itemMat = new THREE.MeshStandardMaterial({
          color: itemColors[item] || 0xcccccc,
          roughness: 0.4,
          metalness: 0.3,
          emissive: itemColors[item] || 0xcccccc,
          emissiveIntensity: 0.1
        });

        const itemMesh = new THREE.Mesh(itemGeo, itemMat);
        const xPos = (posInShelf - 1) * 0.25;
        const yPos = 0.6 + (shelfLevel * 0.5);
        const zPos = 0;

        itemMesh.position.set(xPos, yPos, zPos);
        itemMesh.castShadow = true;
        itemMesh.receiveShadow = true;

        shelfGroup.add(itemMesh);
        shelfGroup.userData.itemMeshes.push(itemMesh);

        itemIndex++;
      });
    }

    function animate() {
      requestAnimationFrame(animate);

      [supplyRobot3D, deliveryRobot3D].forEach(robot => {
        const currentX = robot.position.x;
        const currentZ = robot.position.z;
        const targetX = robot.userData.targetPos.x;
        const targetZ = robot.userData.targetPos.z;

        robot.position.x += (targetX - currentX) * LERP_FACTOR;
        robot.position.z += (targetZ - currentZ) * LERP_FACTOR;

        const dx = targetX - currentX;
        const dz = targetZ - currentZ;
        if (Math.abs(dx) > 0.01 || Math.abs(dz) > 0.01) {
          robot.rotation.y = Math.atan2(dx, dz);

          robot.children.forEach(child => {
            if (child.userData.isWheel) {
              child.rotation.x += 0.2;
            }
          });
        }
      });

      controls.update();
      renderer.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    socket.on('state', (data) => {
      const total = Object.values(data.inventory).reduce((a, b) => a + b, 0);
      document.getElementById('totalItems').textContent = total;
      document.getElementById('itemA').textContent = data.inventory.A || 0;
      document.getElementById('itemB').textContent = data.inventory.B || 0;
      document.getElementById('itemC').textContent = data.inventory.C || 0;
      document.getElementById('deliveredCount').textContent = data.delivered_items.length;

      document.getElementById('supplyPos').textContent =
        `(${data.supply_robot.pos[0]}, ${data.supply_robot.pos[1]})`;
      document.getElementById('supplyCarrying').textContent =
        data.supply_robot.carrying || 'None';

      document.getElementById('deliveryPos').textContent =
        `(${data.delivery_robot.pos[0]}, ${data.delivery_robot.pos[1]})`;
      document.getElementById('deliveryCarrying').textContent =
        data.delivery_robot.carrying || 'None';

      updateRobotPosition(supplyRobot3D, data.supply_robot.pos[1], data.supply_robot.pos[0]);
      updateRobotPosition(deliveryRobot3D, data.delivery_robot.pos[1], data.delivery_robot.pos[0]);

      data.shelves.forEach((shelf, index) => {
        updateShelfItems(index, shelf);
      });

      const queueEl = document.getElementById('incomingQueue');
      if (data.incoming_queue.length === 0) {
        queueEl.innerHTML = '<div style="opacity:0.5; font-style:italic;">No items in queue</div>';
      } else {
        queueEl.innerHTML = data.incoming_queue
          .map(item => `<div class="queue-item">Item ${item}</div>`)
          .join('');
      }
    });

    init();
  </script>
</body>
</html>
